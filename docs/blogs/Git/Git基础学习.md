---
  date: 2024/7/30 17:52
  pageClass: blue-archive
  tags:
    - 未分类
  categories:
    - 未归档
---
# Git基础学习

## 1 介绍
Git是一个免费、开源的分布式版本控制系统，用于快速高效地处理项目的各种版本管理任务。

## 2 版本回退和前进
### 2.1 回退到指定版本
`git reset --hard [版本编号]`

### 2.2 回退到当前最新版本的上一个版本, 使用^代表上一个版本
`git reset --hard HEAD^`

> `--hard`硬回退, 恢复到当前版本已提交的状态, 并抛弃回退版本后续的版本.
>
> `--soft`软回退, 只将版本回退, 保留本地变更, 不会丢失本地修改.
>
> `--mixed`默认值, 恢复到当前版本的已提交状态, 不抛弃后续的版本内容.

### 2.3 查看 git 提交日志
`git log --graph --pretty=oneline`
> 参数
>
> --graph: 查看分支合并图
>
> --pretty: 格式化, oneline 表示单行

### 2.4 查看历史执行日志
`git reflog`

## 3 文件目录、工作区、暂存区(stage)、本地仓库、远程仓库

> 工作区 -> `git add` -> 暂存区 -> `git commit` -> 本地仓库 -> `git push` -> 远程仓库
>
> IDEA中为了简化了git操作, 提交会自动进行`git add`操作, 使用命令需要每次修改前`git add`相关修改的文件.

### 3.1 工作区
在文件目录中, 未add的文件保存在工作区

### 3.2 暂存区
对工作做区中的文件执行`git add`后存放在暂存区, 由git追溯变化

### 3.3 本地仓库
修改完成进行`git commit`的文件存放在本地仓库

### 3.4 远程仓库
本地内容`git push`提交到远程仓库管理

## 4 丢弃修改
> 很多时候某个文件代码写了半天, 提交前发现代码写的太 low 了, 此时可以丢弃修改内容.

丢弃工作区(git add之前)更改的命令如下: `git restore <file>`

撤销暂存区(git add之后git commit之前)提交的命令如下: `git restore --staged <file>`

不关心文件在哪个区, 丢弃修改: `git restore --source=HEAD -- <file>`

## 5 分支
> 分支系统是 git 的最强大的功能.

### 5.1 分支创建、切换和删除
#### 创建分支: `git branch <分支名>`

#### 切换分支: `git switch <分支名>`
> 参数
>
> -c `git switch -c <分支名>`实现切换前创建分支

#### 将分支合并到当前分支: `git merge <分支名>`

例子:

非快速合并&补充提交信息:`git merge --no-ff -m "merged bug fix 101" issue-101`
> 参数
>
> -m: 指定合并信息
>
> --no-ff: 不使用快速合并

#### 删除分支: `git branch -d <分支名>`
> Tips: 如果分支没有被合并, 删除会提示未合并分支, 删除将丢失分支编辑的内容. 如果确实不需要该分支内容, 使用`git branch -D <分支名>`删除.

### 5.2 分支合并冲突
当两个分支对同一个文件进行了编辑, git 可能无法进行自动合并.

git 会使用>>> === <<<来表示冲突内容, 此时就需要手动进行处理冲突.

```text
切换分支前编写的内容
一部分内容开发完成。
<<<<<<< HEAD
dev上的修改。
=======
liuhao上的修改。
liuhao上的修改2。
>>>>>>> liuhao
```

### 5.3 工作暂存
当工作进行中的代码未编写完成, 不能提交的时候, 可以使用git stash命令进行保存工作快照。

`git stash list`: 查询快照.

`git stash`: 保存工作快照.

`git stash apply`: 恢复快照, 恢复后不删除快照.

`git stash pop`: 恢复快照, 恢复后删除快照.

### 5.4 复制提交
当我们基于`master`新建了一个`bugfix`分支, 并且在bugfix分支上完成了修复, 我们切回`master`分支合并掉bugfix, 即修复了这个bug, `dev`分支是基于`master`分支创建的, 则dev上可能也存在这个bug. 则可以使用`cherry-pick`命令来将某个提交应用于其他的分支.

`git cherry-pick <commit>`: 将提交应用于当前分支.

### 5.5 远程分支
之前的操作都是在本地进行的分支管理, 本地创建的分支不推送不会同步到远程.

#### 查看远程库信息`git remote -v`

#### 推送到远程分支`git push origin <远程分支名>`
> 哪些分支要推送到远程?
>
> `master`分支是主分支，因此要时刻与远程同步.
>
> `dev`分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步.
>
> `bug`分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug.
>
> `feature`分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发.

> 推送失败?
>
> 可能是远程的版本和本地版本有冲突. 此时需要先`git pull`拉取最新的版本, 在本地解决冲突后再重新`git push`提交.

### 5.6 分支变基
在分支合并中, 除了使用`git merge`外, 还可以使用`git rebase`来合并分支, 实现的最终合并效果一样. 但`git log`展示的记录内容不同.
1. `git merge`: 保留完整日志, 但长久之后log较为混乱.
2. `git rebase`: 重建日志, 日志清爽, 但会丢失部分内容.

> Tips: 只在本地分支使用`rebase`指令, 不要对已经公开的提交内容做变动.

rebase的原理是将每个变基分支的commit的变动内容重新在的当前分支上合并。