# 草稿

## 系统优化步骤。
### 1 前端优化，减少表单打开时的请求量。
- [x] 静态资源考虑使用专门的静态资源服务器部署。
- [x] 背景图片相关资源进行压缩。
- [x] 懒加载表单，减少crossui请求，从表单越多，减少的请求越多。
- [x] 懒加载地图组件js。减少近400个请求，包括js和css。
- [x]  架构升级，vue-cli版本升级。
### 2 索引优化。
- [x]  BZ_开头的表。
- [x]  APP_表。
- [x]  业务Entity表。
- [x]  产品表索引
- [x]  PCC_开头表。
- [x]  其他模型相关表。
- [x]  DASC安全表索引，USER，ROLE，ACE等表。
- [x]  Activiti 流程信息表索引。
### 3 服务器层面，增加两台应用服务器，使用NGINX代理，启用权重方式，使用更符合现状的负载策略。
- [x]  最小连接数+被动监测，超时记录错误，达到错误上线数时，临时下线错误节点。
	- 请求超过2分钟判断为错误，错误数+1
	- 错误数达到5次时将错误节点临时下线1天。
### 4 应用层面
- [x]  数据字典优化，前端统一获取字典请求。
- [x]  材料加载优化。
- [ ] 保存优化。
- [x] 报盘导入优化：界址点部分内容，从数据包保存修改为原生JDBC批量插入。
	- 对于1万5个界址点项目，导入从50s优化到6s
- [x]  SQL相关内容优化。
	- 子查询拆分。
	- 关联字段索引添加。
	- 关联逻辑优化。
	- 数据查询到数字的sql修改，去除非必要的表。
		- 批准预警查询优化。
		- 批复箱子查询优化。

SQL优化记录

| SQL                                                | 优化前         | 优化后   | 备注          |
| -------------------------------------------------- | ----------- | ----- | ----------- |
| dynamicsql/useingRegulate.xml getApproveBoxEnd     | 2.2s        | 150ms | 办结箱         |
| dynamicsql\useingRegulate.xml getEndApprove_Detail | 1.1s        | 50ms  | 办结箱详情       |
| uf_getboxendcount                                  | 2s          | 150ms | 办结箱数量查询     |
| getAcceptBox                                       | 5s          | 500ms | 接件箱         |
| getUseSPApprove_Detail                             | 600ms-1s    | 100ms | 待办箱子审批箱详情   |
| uf_getboxtodocount                                 | 600ms-900ms | 150ms | 待办箱子数量查询    |
|                                                    | 600ms-900ms | 150ms | 收件箱数量查询     |
| uf_getboxdonecount                                 | 1s          | 800ms | 已办箱数量查询     |
| getApproveBoxDone_sp                               | 1.5s        | 1s    | 已办箱（待进一步优化） |
|                                                    |             |       | 批复箱         |
| getKyPayment                                       | 5s          |       | 矿压协议箱       |
| getQueryBox_DetailSimple                           | 1s          | 400ms | 查询统计子查询优化   |
| getBoxAdminQueryStatistics_Detail                  | 3s          | 50ms  | 运维箱详情优化     |
|                                                    |             |       |             |



